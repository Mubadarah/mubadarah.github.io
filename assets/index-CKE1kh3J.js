import{r as m,a4 as R,a5 as L,h as me,i as pe,k as ge,l as h,H as M,g as S,E as he,aB as ue,e as fe,L as xe,d as ye,j as r,aY as D,T as je,aN as be,be as _,B as W,bh as V,aR as N,c as $e}from"./index-D6AxIjPL.js";import{g as q,a as Se}from"./subscriptions-ZflCNUT4.js";import{d as I}from"./dayjs.min-D144vE-5.js";import"./ar-B7uTiKiK.js";import{i as ve,a as Ce}from"./isSameOrAfter-DDZoFAlt.js";import{u as Ie}from"./useQuery-DvBjJu9T.js";import{A as ze}from"./index-Mp_orLa3.js";import{E as C}from"./index-CYPk6PCz.js";import{C as B}from"./index-mhv3C2lE.js";import{a as X,R as G}from"./ReadOutlined-CtvVfS0P.js";import{C as T,R as Oe,a as Ne,b as Be,c as Te}from"./LinkOutlined-BT2KasNO.js";import{L as $}from"./index-dODVGVdm.js";import{R as Y}from"./UnorderedListOutlined-JizRf90a.js";import{R as K}from"./CalendarOutlined-ClgTM4OZ.js";import{R as we}from"./VideoCameraOutlined-Dir1Dcg5.js";import"./useIcons-CPckANyl.js";import"./Pagination-DFCxWLjJ.js";var Ee={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H212V212h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H612V212h200v200zM464 544H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H212V612h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H612V612h200v200z"}}]},name:"appstore",theme:"outlined"},He=function(t,s){return m.createElement(R,L({},t,{ref:s,icon:Ee}))},Pe=m.forwardRef(He),Ae={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M824.2 699.9a301.55 301.55 0 00-86.4-60.4C783.1 602.8 812 546.8 812 484c0-110.8-92.4-201.7-203.2-200-109.1 1.7-197 90.6-197 200 0 62.8 29 118.8 74.2 155.5a300.95 300.95 0 00-86.4 60.4C345 754.6 314 826.8 312 903.8a8 8 0 008 8.2h56c4.3 0 7.9-3.4 8-7.7 1.9-58 25.4-112.3 66.7-153.5A226.62 226.62 0 01612 684c60.9 0 118.2 23.7 161.3 66.8C814.5 792 838 846.3 840 904.3c.1 4.3 3.7 7.7 8 7.7h56a8 8 0 008-8.2c-2-77-33-149.2-87.8-203.9zM612 612c-34.2 0-66.4-13.3-90.5-37.5a126.86 126.86 0 01-37.5-91.8c.3-32.8 13.4-64.5 36.3-88 24-24.6 56.1-38.3 90.4-38.7 33.9-.3 66.8 12.9 91 36.6 24.8 24.3 38.4 56.8 38.4 91.4 0 34.2-13.3 66.3-37.5 90.5A127.3 127.3 0 01612 612zM361.5 510.4c-.9-8.7-1.4-17.5-1.4-26.4 0-15.9 1.5-31.4 4.3-46.5.7-3.6-1.2-7.3-4.5-8.8-13.6-6.1-26.1-14.5-36.9-25.1a127.54 127.54 0 01-38.7-95.4c.9-32.1 13.8-62.6 36.3-85.6 24.7-25.3 57.9-39.1 93.2-38.7 31.9.3 62.7 12.6 86 34.4 7.9 7.4 14.7 15.6 20.4 24.4 2 3.1 5.9 4.4 9.3 3.2 17.6-6.1 36.2-10.4 55.3-12.4 5.6-.6 8.8-6.6 6.3-11.6-32.5-64.3-98.9-108.7-175.7-109.9-110.9-1.7-203.3 89.2-203.3 199.9 0 62.8 28.9 118.8 74.2 155.5-31.8 14.7-61.1 35-86.5 60.4-54.8 54.7-85.8 126.9-87.8 204a8 8 0 008 8.2h56.1c4.3 0 7.9-3.4 8-7.7 1.9-58 25.4-112.3 66.7-153.5 29.4-29.4 65.4-49.8 104.7-59.7 3.9-1 6.5-4.7 6-8.7z"}}]},name:"team",theme:"outlined"},Re=function(t,s){return m.createElement(R,L({},t,{ref:s,icon:Ae}))},Le=m.forwardRef(Re);const Me=e=>{const{componentCls:t,calc:s}=e;return{[t]:Object.assign(Object.assign({},ge(e)),{margin:0,padding:0,listStyle:"none",[`${t}-item`]:{position:"relative",margin:0,paddingBottom:e.itemPaddingBottom,fontSize:e.fontSize,listStyle:"none","&-tail":{position:"absolute",insetBlockStart:e.itemHeadSize,insetInlineStart:s(s(e.itemHeadSize).sub(e.tailWidth)).div(2).equal(),height:`calc(100% - ${h(e.itemHeadSize)})`,borderInlineStart:`${h(e.tailWidth)} ${e.lineType} ${e.tailColor}`},"&-pending":{[`${t}-item-head`]:{fontSize:e.fontSizeSM,backgroundColor:"transparent"},[`${t}-item-tail`]:{display:"none"}},"&-head":{position:"absolute",width:e.itemHeadSize,height:e.itemHeadSize,backgroundColor:e.dotBg,border:`${h(e.dotBorderWidth)} ${e.lineType} transparent`,borderRadius:"50%","&-blue":{color:e.colorPrimary,borderColor:e.colorPrimary},"&-red":{color:e.colorError,borderColor:e.colorError},"&-green":{color:e.colorSuccess,borderColor:e.colorSuccess},"&-gray":{color:e.colorTextDisabled,borderColor:e.colorTextDisabled}},"&-head-custom":{position:"absolute",insetBlockStart:s(e.itemHeadSize).div(2).equal(),insetInlineStart:s(e.itemHeadSize).div(2).equal(),width:"auto",height:"auto",marginBlockStart:0,paddingBlock:e.customHeadPaddingVertical,lineHeight:1,textAlign:"center",border:0,borderRadius:0,transform:"translate(-50%, -50%)"},"&-content":{position:"relative",insetBlockStart:s(s(e.fontSize).mul(e.lineHeight).sub(e.fontSize)).mul(-1).add(e.lineWidth).equal(),marginInlineStart:s(e.margin).add(e.itemHeadSize).equal(),marginInlineEnd:0,marginBlockStart:0,marginBlockEnd:0,wordBreak:"break-word"},"&-last":{[`> ${t}-item-tail`]:{display:"none"},[`> ${t}-item-content`]:{minHeight:s(e.controlHeightLG).mul(1.2).equal()}}},[`&${t}-alternate,
        &${t}-right,
        &${t}-label`]:{[`${t}-item`]:{"&-tail, &-head, &-head-custom":{insetInlineStart:"50%"},"&-head":{marginInlineStart:s(e.marginXXS).mul(-1).equal(),"&-custom":{marginInlineStart:s(e.tailWidth).div(2).equal()}},"&-left":{[`${t}-item-content`]:{insetInlineStart:`calc(50% - ${h(e.marginXXS)})`,width:`calc(50% - ${h(e.marginSM)})`,textAlign:"start"}},"&-right":{[`${t}-item-content`]:{width:`calc(50% - ${h(e.marginSM)})`,margin:0,textAlign:"end"}}}},[`&${t}-right`]:{[`${t}-item-right`]:{[`${t}-item-tail,
            ${t}-item-head,
            ${t}-item-head-custom`]:{insetInlineStart:`calc(100% - ${h(s(s(e.itemHeadSize).add(e.tailWidth)).div(2).equal())})`},[`${t}-item-content`]:{width:`calc(100% - ${h(s(e.itemHeadSize).add(e.marginXS).equal())})`}}},[`&${t}-pending
        ${t}-item-last
        ${t}-item-tail`]:{display:"block",height:`calc(100% - ${h(e.margin)})`,borderInlineStart:`${h(e.tailWidth)} dotted ${e.tailColor}`},[`&${t}-reverse
        ${t}-item-last
        ${t}-item-tail`]:{display:"none"},[`&${t}-reverse ${t}-item-pending`]:{[`${t}-item-tail`]:{insetBlockStart:e.margin,display:"block",height:`calc(100% - ${h(e.margin)})`,borderInlineStart:`${h(e.tailWidth)} dotted ${e.tailColor}`},[`${t}-item-content`]:{minHeight:s(e.controlHeightLG).mul(1.2).equal()}},[`&${t}-label`]:{[`${t}-item-label`]:{position:"absolute",insetBlockStart:s(s(e.fontSize).mul(e.lineHeight).sub(e.fontSize)).mul(-1).add(e.tailWidth).equal(),width:`calc(50% - ${h(e.marginSM)})`,textAlign:"end"},[`${t}-item-right`]:{[`${t}-item-label`]:{insetInlineStart:`calc(50% + ${h(e.marginSM)})`,width:`calc(50% - ${h(e.marginSM)})`,textAlign:"start"}}},"&-rtl":{direction:"rtl",[`${t}-item-head-custom`]:{transform:"translate(50%, -50%)"}}})}},De=e=>({tailColor:e.colorSplit,tailWidth:e.lineWidthBold,dotBorderWidth:e.wireframe?e.lineWidthBold:e.lineWidth*3,dotBg:e.colorBgContainer,itemPaddingBottom:e.padding*1.25}),_e=me("Timeline",e=>{const t=pe(e,{itemHeadSize:10,customHeadPaddingVertical:e.paddingXXS,paddingInlineEnd:2});return[Me(t)]},De);var We=function(e,t){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(s[n[i]]=e[n[i]]);return s};const F=e=>{var{prefixCls:t,className:s,color:n="blue",dot:i,pending:l=!1,position:g,label:o,children:c}=e,d=We(e,["prefixCls","className","color","dot","pending","position","label","children"]);const{getPrefixCls:f}=m.useContext(M),a=f("timeline",t),x=S(`${a}-item`,{[`${a}-item-pending`]:l},s),u=/blue|red|green|gray/.test(n||"")?void 0:n,y=S(`${a}-item-head`,{[`${a}-item-head-custom`]:!!i,[`${a}-item-head-${n}`]:!u});return m.createElement("li",Object.assign({},d,{className:x}),o&&m.createElement("div",{className:`${a}-item-label`},o),m.createElement("div",{className:`${a}-item-tail`}),m.createElement("div",{className:y,style:{borderColor:u,color:u}},i),m.createElement("div",{className:`${a}-item-content`},c))};var P=function(e,t){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(s[n[i]]=e[n[i]]);return s};const Ve=e=>{var{prefixCls:t,className:s,pending:n=!1,children:i,items:l,rootClassName:g,reverse:o=!1,direction:c,hashId:d,pendingDot:f,mode:a=""}=e,x=P(e,["prefixCls","className","pending","children","items","rootClassName","reverse","direction","hashId","pendingDot","mode"]);const u=(p,b)=>a==="alternate"?p==="right"?`${t}-item-right`:p==="left"?`${t}-item-left`:b%2===0?`${t}-item-left`:`${t}-item-right`:a==="left"?`${t}-item-left`:a==="right"?`${t}-item-right`:p==="right"?`${t}-item-right`:"",y=he(l||[]),z=typeof n=="boolean"?null:n;n&&y.push({pending:!!n,dot:f||m.createElement(ue,null),children:z}),o&&y.reverse();const w=y.length,E=`${t}-item-last`,se=y.filter(p=>!!p).map((p,b)=>{var O;const le=b===w-2?E:"",oe=b===w-1?E:"",{className:ce}=p,de=P(p,["className"]);return m.createElement(F,Object.assign({},de,{className:S([ce,!o&&n?le:oe,u((O=p==null?void 0:p.position)!==null&&O!==void 0?O:"",b)]),key:(p==null?void 0:p.key)||b}))}),H=y.some(p=>!!(p!=null&&p.label)),ae=S(t,{[`${t}-pending`]:!!n,[`${t}-reverse`]:!!o,[`${t}-${a}`]:!!a&&!H,[`${t}-label`]:H,[`${t}-rtl`]:c==="rtl"},s,g,d);return m.createElement("ul",Object.assign({},x,{className:ae}),se)};function qe(e,t){return e&&Array.isArray(e)?e:fe(t).map(s=>{var n,i;return Object.assign({children:(i=(n=s==null?void 0:s.props)===null||n===void 0?void 0:n.children)!==null&&i!==void 0?i:""},s.props)})}var Xe=function(e,t){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(s[n[i]]=e[n[i]]);return s};const v=e=>{const{getPrefixCls:t,direction:s,timeline:n}=m.useContext(M),{prefixCls:i,children:l,items:g,className:o,style:c}=e,d=Xe(e,["prefixCls","children","items","className","style"]),f=t("timeline",i),a=xe(f),[x,u,y]=_e(f,a),z=qe(g,l);return x(m.createElement(Ve,Object.assign({},d,{className:S(n==null?void 0:n.className,o,y,a),style:Object.assign(Object.assign({},n==null?void 0:n.style),c),prefixCls:f,direction:s,items:z,hashId:u})))};v.Item=F;I.locale("ar");I.extend(ve);I.extend(Ce);const{Content:Ge}=D,{Title:Q,Text:j,Paragraph:U,Link:J}=je,{Panel:Z}=T,{TabPane:A}=_,k=e=>{switch(e){case"video":case"embedded":return r.jsx(we,{});case"pdf":return r.jsx(Te,{});case"audio":return r.jsx(Be,{});case"docx":return r.jsx(Ne,{});default:return r.jsx(Oe,{})}},ee=e=>{switch(e){case"video":return"red";case"pdf":return"blue";case"audio":return"purple";case"docx":return"cyan";case"embedded":return"orange";default:return"default"}},te=e=>{try{return new Date(e).toLocaleDateString("ar-EG",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}catch{return e}},re=e=>{window.location.href=`#subscriptions/${e}`},ie={marginBottom:"12px"},Ye={marginBottom:"10px",paddingBottom:"8px",borderBottom:"1px dashed #f0f0f0",fontSize:"0.85em",lineHeight:1.4},ne={fontWeight:500,marginBottom:"8px",color:"#555"},Ke=({subscriptions:e})=>{const t={marginBottom:"32px"},s={paddingBottom:"15px"},n=i=>i.reduce((l,g)=>{const o=g.date.split("T")[0];return l[o]||(l[o]=[]),l[o].push(g),l},{});return r.jsx("div",{children:e.map(i=>{var c;const l=q(i),g=(l==null?void 0:l.tasks)||[],o=m.useMemo(()=>{if(g.length===0)return[];const f=[...g.map(u=>({...u,programId:i.program.id,programName:i.program.name||"N/A",levelName:(l==null?void 0:l.name)||"N/A",subscriptionId:(i==null?void 0:i.id)||""}))].sort((u,y)=>new Date(u.date).getTime()-new Date(y.date).getTime()),a=n(f);return Object.keys(a).map(u=>({date:u,tasks:a[u]}))},[i,g,l]);return r.jsxs(B,{title:r.jsxs($e,{children:[r.jsx(X,{})," ",((c=i.program)==null?void 0:c.name)||"N/A"]}),extra:r.jsxs(r.Fragment,{children:[r.jsx(W,{type:"link",icon:r.jsx(V,{}),size:"small",onClick:()=>re(i.id),style:{float:"left",padding:"0 5px",fontSize:"0.85em"},children:"عرض التفاصيل"}),r.jsx(N,{color:"green",children:"نشط"})]}),style:t,headStyle:{backgroundColor:"#fafafa"},children:[r.jsxs(Q,{level:5,style:{marginBottom:"20px"},children:[r.jsx(G,{style:{marginLeft:"8px"}})," ",(l==null?void 0:l.name)||"N/A"]}),g.length===0&&r.jsx(C,{description:"لا توجد مهام مجدولة لهذا المستوى.",image:C.PRESENTED_IMAGE_SIMPLE}),g.length>0&&r.jsx(v,{mode:"left",children:o.map(({date:d,tasks:f})=>r.jsx(v.Item,{label:r.jsx(j,{style:ne,children:te(d)}),dot:r.jsx(K,{style:{fontSize:"16px"}}),style:s,children:f.map(a=>r.jsxs(B,{size:"small",bordered:!1,style:ie,bodyStyle:{padding:"12px"},children:[a.note&&r.jsx(U,{children:a.note}),!a.note&&a.lessons.length===0&&r.jsx(j,{type:"secondary",children:"لا توجد تفاصيل."}),a.lessons&&a.lessons.length>0&&r.jsx(T,{ghost:!0,expandIconPosition:"right",size:"small",children:r.jsx(Z,{header:r.jsxs(j,{type:"secondary",style:{fontSize:"0.9em"},children:[r.jsx(Y,{style:{marginLeft:"8px"}})," ","عرض الدروس (",a.lessons.length,")"]}),children:r.jsx($,{size:"small",dataSource:a.lessons,renderItem:x=>r.jsxs($.Item,{style:{padding:"6px 0"},children:[" ",r.jsx($.Item.Meta,{avatar:k(x.type),title:r.jsx(J,{href:`#/subscriptions/${a.subscriptionId}`,target:"_blank",rel:"noopener noreferrer",disabled:!x.url,children:x.title})})," ",r.jsx(N,{color:ee(x.type),children:x.type})," "]},x.id)})},`panel-task-${a.id}`)}),r.jsx("div",{style:{clear:"both"}})]},a.id))},`${i.id}-${d}`))})]},i.id)})})},Fe=({groupedAndSortedTasks:e})=>{const t={paddingBottom:"15px"};return r.jsxs("div",{children:[e.length===0&&r.jsx(C,{description:"لا توجد مهام مجدولة في اشتراكاتك."}),e.length>0&&r.jsx(v,{mode:"left",children:e.map(({date:s,tasks:n})=>r.jsx(v.Item,{label:r.jsx(j,{style:ne,children:te(s)}),dot:r.jsx(K,{style:{fontSize:"16px"}}),style:t,children:n.map(i=>r.jsxs(B,{size:"small",bordered:!1,style:ie,bodyStyle:{padding:"12px"},children:[r.jsxs("div",{style:Ye,children:[r.jsxs(j,{type:"secondary",children:[" ",r.jsx(X,{style:{marginLeft:"5px"}})," ",i.programName," "]}),r.jsxs(j,{type:"secondary",style:{marginRight:"10px"},children:[" ",r.jsx(G,{style:{marginLeft:"5px"}})," ",i.levelName," "]}),r.jsx(W,{type:"link",icon:r.jsx(V,{}),size:"small",onClick:()=>re(i.subscriptionId),style:{float:"left",padding:"0 5px",fontSize:"0.85em"},children:"عرض التفاصيل"})]}),i.note&&r.jsx(U,{children:i.note}),!i.note&&i.lessons.length===0&&r.jsx(j,{type:"secondary",style:{display:"block"},children:"لا توجد تفاصيل إضافية."}),i.lessons&&i.lessons.length>0&&r.jsx(T,{ghost:!0,expandIconPosition:"right",size:"small",children:r.jsx(Z,{header:r.jsxs(j,{type:"secondary",style:{fontSize:"0.9em"},children:[r.jsx(Y,{style:{marginLeft:"8px"}})," ","عرض الدروس (",i.lessons.length,")"]}),children:r.jsx($,{size:"small",dataSource:i.lessons,renderItem:l=>r.jsxs($.Item,{style:{padding:"6px 0"},children:[" ",r.jsx($.Item.Meta,{avatar:k(l.type),title:r.jsx(J,{href:`#/subscriptions/${i.programId}`,target:"_blank",rel:"noopener noreferrer",disabled:!l.url,children:l.title})})," ",r.jsx(N,{color:ee(l.type),children:l.type})," "]},l.id)})},`panel-task-${i.id}`)}),r.jsx("div",{style:{clear:"both"}})]},i.id))},s))})]})},pt=()=>{const{data:e,error:t,isLoading:s}=Ie({queryKey:["subscriptions"],queryFn:()=>Se.get({}),refetchOnWindowFocus:!1});t&&ye.error("فشل تحميل بيانات الاشتراكات.");const n=m.useMemo(()=>!(e!=null&&e.items)||(e==null?void 0:e.items.length)===0?[]:e==null?void 0:e.items.flatMap(o=>{const c=q(o);return((c==null?void 0:c.tasks)||[]).map(d=>({...d,programId:o.program.id,programName:o.program.name||"N/A",levelName:(c==null?void 0:c.name)||"N/A",subscriptionId:(o==null?void 0:o.id)||""}))}),[e==null?void 0:e.items]),i=m.useMemo(()=>n.reduce((o,c)=>{try{const d=I(c.date).format("YYYY-MM-DD");o[d]||(o[d]=[]),o[d].push(c)}catch(d){console.error("Err group:",c,d)}return o},{}),[n]),l=m.useMemo(()=>Object.keys(i).sort((c,d)=>new Date(c).getTime()-new Date(d).getTime()).map(c=>({date:c,tasks:i[c].sort((d,f)=>d.programName.localeCompare(f.programName))})),[i]),g={padding:"24px 48px"};return r.jsx(D,{style:{minHeight:"100vh"},children:r.jsxs(Ge,{style:g,children:[r.jsx(Q,{level:2,style:{marginBottom:"24px",textAlign:"right"},children:"إشتراكاتي"}),s&&r.jsx("div",{style:{textAlign:"center",padding:"50px"},children:r.jsx(be,{size:"large",tip:"جاري تحميل..."})}),t&&!s&&r.jsx(ze,{message:"خطأ في تحميل البيانات",description:t.message,type:"error",showIcon:!0,style:{marginBottom:"24px"}}),!s&&!t&&(e==null?void 0:e.items.length)===0&&r.jsx(C,{description:"أنت غير مشترك في أي برامج نشطة حالياً."}),!s&&!t&&((e==null?void 0:e.items.length)??0)>0&&r.jsxs(_,{defaultActiveKey:"unified",type:"card",children:[r.jsx(A,{tab:r.jsxs("span",{children:[r.jsx(Le,{})," العرض حسب التاريخ"]}),children:r.jsx(Fe,{groupedAndSortedTasks:l})},"unified"),r.jsx(A,{tab:r.jsxs("span",{children:[r.jsx(Pe,{})," عرض حسب الاشتراك"]}),children:r.jsx(Ke,{subscriptions:(e==null?void 0:e.items)??[]})},"subscription")]})]})})};export{pt as default};
